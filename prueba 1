local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Sherya-Script-Private/Elerium-V5/refs/heads/main/Library", true))()
local window = library:AddWindow("Sherya Script | Galaxy Hub", {
    main_color = Color3.fromRGB(0, 0, 0),
    min_size = Vector2.new(600, 660),
    can_resize = true,
})

local Farm = window:AddTab("Farm")
local Opti = window:AddTab("Optimizacion")
local Calculator = window:AddTab("Calculator")
local creditsTab = window:AddTab("Credits")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- Variables
local packFarmTarget = false
local packFarmInfinite = false
local fastStrength = false
local targetRebirth = math.huge

local targetPackToggle, infinitePackToggle, fastStrengthToggle

-- Funciones
local function unequipAllPets()
    local petsFolder = player:FindFirstChild("petsFolder")
    if not petsFolder then return end

    for _, folder in pairs(petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                ReplicatedStorage.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
end

local function equipSpecificPacks(packName, count)
    unequipAllPets()
    task.wait(0.2)

    local packs = {}
    if player.petsFolder and player.petsFolder:FindFirstChild("Unique") then
        for _, pet in pairs(player.petsFolder.Unique:GetChildren()) do
            if pet.Name == packName then
                table.insert(packs, pet)
            end
        end
    end

    local toEquip = math.min(count, #packs)
    for i = 1, toEquip do
        ReplicatedStorage.rEvents.equipPetEvent:FireServer("equipPet", packs[i])
        task.wait(0.1)
    end
end

local function findMachine(name)
    local folder = workspace:FindFirstChild("machinesFolder")
    if folder and folder:FindFirstChild(name) then
        return folder[name]
    end
    for _, subfolder in pairs(workspace:GetChildren()) do
        if subfolder:IsA("Folder") and subfolder.Name:lower():find("machines") then
            local machine = subfolder:FindFirstChild(name)
            if machine then return machine end
        end
    end
end

local function pressE()
    local vim = game:GetService("VirtualInputManager")
    vim:SendKeyEvent(true, "E", false, game)
    task.wait(0.1)
    vim:SendKeyEvent(false, "E", false, game)
end

local isPositionLocked = false
local originalCFrame = nil

local function lockPosition(lock)
    isPositionLocked = lock

    if lock and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        originalCFrame = player.Character.HumanoidRootPart.CFrame

        if not _G.positionConnection then
            _G.positionConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if isPositionLocked and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    player.Character.HumanoidRootPart.CFrame = originalCFrame
                    player.Character.HumanoidRootPart.Velocity = Vector3.new(0, 0, 0)
                    player.Character.HumanoidRootPart.RotVelocity = Vector3.new(0, 0, 0)
                end
            end)
        end
    elseif not lock and _G.positionConnection then
        _G.positionConnection:Disconnect()
        _G.positionConnection = nil
    end
end

-- GUI INTERFAZ (usa tu sistema de UI aquí)
-- Aquí asumo que `Farm` es un tab ya creado en tu sistema de UI

Farm:AddTextBox("Target Rebirth Amount", function(text)
    local num = tonumber(text)
    targetRebirth = num or math.huge
end)

Farm:AddLabel("")
Farm:AddLabel("-----Fast Rebirth OP-----")

targetPackToggle = Farm:AddSwitch("Pack Farm | Rebirth Target", function(state)
    packFarmTarget = state

    if state then
        if packFarmInfinite and infinitePackToggle then
            packFarmInfinite = false
            infinitePackToggle:Set(false)
        end
        if fastStrength and fastStrengthToggle then
            fastStrength = false
            fastStrengthToggle:Set(false)
        end

        if targetRebirth > player.leaderstats.Rebirths.Value then
            task.spawn(function()
                lockPosition(true)
                local rebirthValues = { [0]=1, [1]=2, [2]=4, [3]=6, [4]=8, [5]=10, [6]=12, [7]=14, [8]=16 }

                while packFarmTarget do
                    local rebirths = player.leaderstats.Rebirths.Value
                    if rebirths >= targetRebirth then break end

                    local cost = 10000 + (5000 * rebirths)
                    if player.ultimatesFolder:FindFirstChild("Golden Rebirth") then
                        cost = cost * (1 - (player.ultimatesFolder["Golden Rebirth"].Value * 0.1))
                    end

                    local needed = targetRebirth - rebirths
                    local packCount = 0

                    for i = 8, 1, -1 do
                        if rebirthValues[i] <= needed then
                            packCount = i
                            break
                        end
                    end

                    equipSpecificPacks("Swift Samurai", 8)

                    while packFarmTarget and player.leaderstats.Strength.Value < cost do
                        for _ = 1, 10 do
                            player.muscleEvent:FireServer("rep")
                        end
                        task.wait()
                    end

                    equipSpecificPacks("Tribal Overlord", packCount)

                    local machine = findMachine("Jungle Bar Lift")
                    if machine and machine:FindFirstChild("interactSeat") then
                        player.Character.HumanoidRootPart.CFrame = machine.interactSeat.CFrame * CFrame.new(0, 3, 0)
                        repeat
                            task.wait(0.1)
                            pressE()
                        until player.Character.Humanoid.Sit
                    end

                    local before = player.leaderstats.Rebirths.Value
                    repeat
                        ReplicatedStorage.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
                        task.wait(0.1)
                    until player.leaderstats.Rebirths.Value > before

                    task.wait(0.5)
                end

                lockPosition(false)
                unequipAllPets()
                packFarmTarget = false
                targetPackToggle:Set(false)
            end)
        else
            packFarmTarget = false
            targetPackToggle:Set(false)
        end
    else
        lockPosition(false)
        unequipAllPets()
    end
end)

infinitePackToggle = Farm:AddSwitch("Pack Farm | Fast Rebirth", function(state)
    packFarmInfinite = state

    if state then
        if packFarmTarget and targetPackToggle then
            packFarmTarget = false
            targetPackToggle:Set(false)
        end
        if fastStrength and fastStrengthToggle then
            fastStrength = false
            fastStrengthToggle:Set(false)
        end

        task.spawn(function()
            lockPosition(true)
            while packFarmInfinite do
                local rebirths = player.leaderstats.Rebirths.Value
                local cost = 10000 + (5000 * rebirths)
                if player.ultimatesFolder:FindFirstChild("Golden Rebirth") then
                    cost = cost * (1 - (player.ultimatesFolder["Golden Rebirth"].Value * 0.1))
                end

                equipSpecificPacks("Swift Samurai", 8)
                while packFarmInfinite and player.leaderstats.Strength.Value < cost do
                    for _ = 1, 10 do
                        player.muscleEvent:FireServer("rep")
                    end
                    task.wait()
                end

                equipSpecificPacks("Tribal Overlord", 8)
                local machine = findMachine("Jungle Bar Lift")
                if machine and machine:FindFirstChild("interactSeat") then
                    player.Character.HumanoidRootPart.CFrame = machine.interactSeat.CFrame * CFrame.new(0, 3, 0)
                    repeat
                        task.wait(0.1)
                        pressE()
                    until player.Character.Humanoid.Sit
                end

                local before = player.leaderstats.Rebirths.Value
                repeat
                    ReplicatedStorage.rEvents.rebirthRemote:InvokeServer("rebirthRequest")
                    task.wait(0.1)
                until player.leaderstats.Rebirths.Value > before

                task.wait(0.5)
            end
            lockPosition(false)
            unequipAllPets()
        end)
    else
        lockPosition(false)
        unequipAllPets()
    end
end)

Farm:AddSwitch("Lock Position", function(Value)
    if Value then
        local currentPos = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame
        getgenv().posLock = game:GetService("RunService").Heartbeat:Connect(function()
            if game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = currentPos
            end
        end)
    else
        if getgenv().posLock then
            getgenv().posLock:Disconnect()
            getgenv().posLock = nil
        end
    end
end)

Farm:AddLabel("")
Farm:AddLabel("-----Fast Strength OP-----")

fastStrengthToggle = Farm:AddSwitch("Pack Farm | Fast Strength", function(state)
    fastStrength = state

    if state then
        if packFarmTarget and targetPackToggle then
            packFarmTarget = false
            targetPackToggle:Set(false)
        end
        if packFarmInfinite and infinitePackToggle then
            packFarmInfinite = false
            infinitePackToggle:Set(false)
        end

        task.spawn(function()
            equipSpecificPacks("Swift Samurai", 8)
            while fastStrength do
                for _ = 1, 28 do
                    player.muscleEvent:FireServer("rep")
                end
                task.wait()
            end
            unequipAllPets()
        end)
    else
        unequipAllPets()
    end
end)

local function eatProteinEgg()
    pcall(function()
        local backpack = player:WaitForChild("Backpack")
        local character = player.Character or player.CharacterAdded:Wait()

        local egg = backpack:FindFirstChild("Protein Egg")
        if egg then
            egg.Parent = character
            egg:Activate()
        end
    end)
end

-- Spawn para auto eat
task.spawn(function()
    while true do
        if autoEatEnabled then
            eatProteinEgg()
            task.wait(1800) -- 30 minutos
        else
            task.wait(1)
        end
    end
end)

-- Switches y botones corregidos para FarmTab
Farm:AddSwitch("Auto Eat Egg 30 Minutes", function(state)
    autoEatEnabled = state
end)

-- Variables para el Anti AFK GUI
local antiAFKActive = false
local antiAFKConnection = nil
local sessionStartTime = tick()
local sheryaGUI = nil

-- Función para crear la GUI de monitoreo
local function createSheryaGUI()
    -- Eliminar GUI existente si existe
    if sheryaGUI then
        sheryaGUI:Destroy()
        sheryaGUI = nil
    end
    
    local Players = game:GetService("Players")
    local RunService = game:GetService("RunService")
    local Stats = game:GetService("Stats")
    local player = Players.LocalPlayer
    local playerGui = player:WaitForChild("PlayerGui")
    
    -- Crear ScreenGui principal
    sheryaGUI = Instance.new("ScreenGui")
    sheryaGUI.Name = "SheryaScript"
    sheryaGUI.Parent = playerGui
    sheryaGUI.ResetOnSpawn = false
    sheryaGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Frame principal
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Parent = sheryaGUI
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25) -- Negro oscuro
    mainFrame.BorderSizePixel = 0
    mainFrame.Position = UDim2.new(0, 10, 0, 10)
    mainFrame.Size = UDim2.new(0, 250, 0, 120)
    mainFrame.Active = true
    mainFrame.Draggable = true -- Hacer la GUI movible
    
    -- Esquinas redondeadas
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = mainFrame
    
    -- Título
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Parent = mainFrame
    titleLabel.BackgroundTransparency = 1
    titleLabel.Position = UDim2.new(0, 0, 0, 0)
    titleLabel.Size = UDim2.new(1, 0, 0, 25)
    titleLabel.Font = Enum.Font.SourceSansBold
    titleLabel.Text = "Sherya Script"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextScaled = true
    titleLabel.TextWrapped = true
    
    -- Ping Label
    local pingLabel = Instance.new("TextLabel")
    pingLabel.Name = "Ping"
    pingLabel.Parent = mainFrame
    pingLabel.BackgroundTransparency = 1
    pingLabel.Position = UDim2.new(0, 5, 0, 25)
    pingLabel.Size = UDim2.new(1, -10, 0, 20)
    pingLabel.Font = Enum.Font.SourceSans
    pingLabel.Text = "Ping: 0 ms"
    pingLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    pingLabel.TextScaled = true
    pingLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    -- FPS Label
    local fpsLabel = Instance.new("TextLabel")
    fpsLabel.Name = "FPS"
    fpsLabel.Parent = mainFrame
    fpsLabel.BackgroundTransparency = 1
    fpsLabel.Position = UDim2.new(0, 5, 0, 45)
    fpsLabel.Size = UDim2.new(1, -10, 0, 20)
    fpsLabel.Font = Enum.Font.SourceSans
    fpsLabel.Text = "FPS: 0"
    fpsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    fpsLabel.TextScaled = true
    fpsLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Session Time Label
    local sessionLabel = Instance.new("TextLabel")
    sessionLabel.Name = "SessionTime"
    sessionLabel.Parent = mainFrame
    sessionLabel.BackgroundTransparency = 1
    sessionLabel.Position = UDim2.new(0, 5, 0, 65)
    sessionLabel.Size = UDim2.new(1, -10, 0, 20)
    sessionLabel.Font = Enum.Font.SourceSans
    sessionLabel.Text = "Session: 00:00:00"
    sessionLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    sessionLabel.TextScaled = true
    sessionLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Status Label
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Name = "Status"
    statusLabel.Parent = mainFrame
    statusLabel.BackgroundTransparency = 1
    statusLabel.Position = UDim2.new(0, 5, 0, 85)
    statusLabel.Size = UDim2.new(1, -10, 0, 20)
    statusLabel.Font = Enum.Font.SourceSans
    statusLabel.Text = "Anti-AFK Activo"
    statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    statusLabel.TextScaled = true
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Variables para calcular FPS
    local frameCount = 0
    local lastTime = tick()
    local currentFPS = 0
    
    -- Función para formatear tiempo
    local function formatTime(seconds)
        local hours = math.floor(seconds / 3600)
        local minutes = math.floor((seconds % 3600) / 60)
        local secs = math.floor(seconds % 60)
        return string.format("%02d:%02d:%02d", hours, minutes, secs)
    end
    
    -- Función para actualizar estadísticas
    local function updateStats()
        -- Actualizar FPS
        frameCount = frameCount + 1
        local currentTime = tick()
        if currentTime - lastTime >= 1 then
            currentFPS = frameCount
            frameCount = 0
            lastTime = currentTime
        end
        
        -- Actualizar Ping
        local ping = math.round(Stats.Network.ServerStatsItem["Data Ping"]:GetValue())
        
        -- Actualizar tiempo de sesión
        local sessionTime = tick() - sessionStartTime
        
        -- Actualizar labels
        pingLabel.Text = "Ping: " .. ping .. " ms"
        fpsLabel.Text = "FPS: " .. currentFPS
        sessionLabel.Text = "Session: " .. formatTime(sessionTime)
    end
    
    -- Conectar actualización de estadísticas
    RunService.Heartbeat:Connect(updateStats)
    
    return sheryaGUI
end

-- Función para activar Anti-AFK
local function startAntiAFK()
    if antiAFKConnection then
        antiAFKConnection:Disconnect()
    end
    
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    
    -- Sistema Anti-AFK mejorado
    antiAFKConnection = game:GetService("RunService").Heartbeat:Connect(function()
        -- Movimiento micro para evitar AFK
        if humanoid and humanoid.Parent then
            local currentTime = tick()
            local movement = math.sin(currentTime * 0.1) * 0.01
            humanoid:Move(Vector3.new(movement, 0, 0), false)
        end
    end)
    
    -- También activar anti-lag básico
    local function optimizeGame()
        -- Reducir calidad gráfica automáticamente
        local lighting = game:GetService("Lighting")
        lighting.GlobalShadows = false
        lighting.Technology = Enum.Technology.Compatibility
        
        -- Optimizar workspace
        workspace.StreamingEnabled = true
        workspace.StreamingTargetRadius = 100
        
        -- Configurar settings para mejor rendimiento
        settings().Rendering.QualityLevel = "Level01"
    end
    
    optimizeGame()
end

-- Función para detener Anti-AFK
local function stopAntiAFK()
    if antiAFKConnection then
        antiAFKConnection:Disconnect()
        antiAFKConnection = nil
    end
    
    if sheryaGUI then
        sheryaGUI:Destroy()
        sheryaGUI = nil
    end
end

-- Agregar botón al OP Things folder
Opti:AddButton("Anti AFK GUI", function()
    if not antiAFKActive then
        -- Activar Anti-AFK
        antiAFKActive = true
        sessionStartTime = tick() -- Reiniciar tiempo de sesión
        
        -- Crear y mostrar GUI
        createSheryaGUI()
        
        -- Iniciar sistema Anti-AFK
        startAntiAFK()
        
        -- Notificación de activación
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Sherya Script";
            Text = "Anti-AFK activado! GUI de monitoreo visible.";
            Duration = 5;
        })
        
        print("Anti-AFK y GUI de monitoreo activados")
        
    else
        -- Desactivar Anti-AFK
        antiAFKActive = false
        
        -- Detener sistema
        stopAntiAFK()
        
        -- Notificación de desactivación
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Sherya Script";
            Text = "Anti-AFK desactivado! GUI cerrada.";
            Duration = 5;
        })
        
        print("Anti-AFK desactivado")
    end
end)

Opti:AddButton("Anti Lag", function()
    local player = game.Players.LocalPlayer
    local playerGui = player:WaitForChild("PlayerGui")
    local lighting = game:GetService("Lighting")

    -- Eliminar todas las GUIs del jugador
    for _, gui in pairs(playerGui:GetChildren()) do
        if gui:IsA("ScreenGui") then
            gui:Destroy()
        end
    end

    -- Quitar partículas
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("ParticleEmitter") then
            obj:Destroy()
        end
    end

    -- Quitar luces
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("PointLight") or obj:IsA("SpotLight") or obj:IsA("SurfaceLight") then
            obj:Destroy()
        end
    end

    -- Eliminar cielos existentes
    for _, v in pairs(lighting:GetChildren()) do
        if v:IsA("Sky") then
            v:Destroy()
        end
    end

    -- Crear cielo oscuro
    local darkSky = Instance.new("Sky")
    darkSky.Name = "DarkSky"
    darkSky.SkyboxBk = "rbxassetid://0"
    darkSky.SkyboxDn = "rbxassetid://0"
    darkSky.SkyboxFt = "rbxassetid://0"
    darkSky.SkyboxLf = "rbxassetid://0"
    darkSky.SkyboxRt = "rbxassetid://0"
    darkSky.SkyboxUp = "rbxassetid://0"
    darkSky.Parent = lighting

    lighting.Brightness = 0
    lighting.ClockTime = 0
    lighting.TimeOfDay = "00:00:00"
    lighting.OutdoorAmbient = Color3.new(0, 0, 0)
    lighting.Ambient = Color3.new(0, 0, 0)
    lighting.FogColor = Color3.new(0, 0, 0)
    lighting.FogEnd = 100

    -- Refuerzo periódico del anti-lag
    task.spawn(function()
        while true do
            wait(5)
            if not lighting:FindFirstChild("DarkSky") then
                darkSky:Clone().Parent = lighting
            end
            lighting.Brightness = 0
            lighting.ClockTime = 0
            lighting.OutdoorAmbient = Color3.new(0, 0, 0)
            lighting.Ambient = Color3.new(0, 0, 0)
            lighting.FogColor = Color3.new(0, 0, 0)
            lighting.FogEnd = 100
        end
    end)
end)
